# LLM 中的自动化评估方法——BLEU

## 1. BLEU 是什么？

BLEU（Bilingual Evaluation Understudy）是一种广泛用于评估机器翻译系统输出质量的方法。它最初是为评估机器翻译系统的输出而设计的，但后来也被应用于其他自然语言处理任务，如文本生成和摘要生成。BLEU的核心思想是通过比较机器生成的文本与一组参考文本（通常是人工编写的正确翻译或生成文本）之间的相似性来评估生成文本的质量。

## 2. BLEU 的工作原理

BLEU 方法主要基于以下几个关键概念：

1. **N-gram 匹配**：
   - BLEU 通过计算机器生成文本中的 n-gram（连续的 n 个词）与参考文本中的 n-gram 的匹配情况来评估生成文本的质量。
   - 通常，BLEU 会计算 1-gram（unigram）、2-gram（bigram）、3-gram（trigram）和 4-gram（4-gram）的匹配情况。
   - 举例：对于句子“the cat is on the mat”
     - 1-gram：the、cat、is、on、mat
     - 2-gram：the cat、cat is、is on、on the、the mat
     - 3-gram：the cat is、cat is on、is on the、on the mat

2. **精度（Precision）**：
   - 对于每个 n-gram，BLEU 计算机器生成文本中的 n-gram 在参考文本中出现的次数。
   - 如果一个 n-gram 在机器生成文本中出现的次数超过了它在参考文本中出现的次数，则只计算参考文本中出现的次数。
   - 举例：若参考文本为“the cat is on the mat”，而生成文本为“the cat sat on the mat”
     - 对于1-gram，计算precision为5/6，以为“sat”没有匹配到参考文本中
     - 对于2-gram，计算precision为3/5，因为“cat sat” 和 “sat on”没有匹配到参考文本中
     - 对于3-gram，计算precision为1/4，因为“the cat sat”、“cat sat on”、“sat on the”没有匹配到参考文本中

3. **惩罚因子（Brevity Penalty）**：
   - BLEU 还考虑了生成文本的长度。如果生成文本的长度明显短于参考文本的长度，BLEU 会引入一个惩罚因子，以避免生成过短的文本。
   - 惩罚因子通过比较生成文本的长度与参考文本的最短长度来计算。
   - 计算公式为：
   $$BP = \begin{cases} 1 & \text{ if } c>r \\ \exp(1-\frac{r}{c}) & \text{ if } c<=r \end{cases}$$